<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Demo here</h1>
    <button id="btn-click">Open Payment MB</button>
    <script>
      console.log("start");
      console.log(window.location.search);

      const params = JSON.stringify({
        type: "PAYMENT_HUB_TRANSACTION",
        data: {
          merchant: {
            code: "MBAL",
            name: "Bảo hiểm nhân thọ MB AGEAS LIFE",
          },
          type: {
            code: "BHUT",
            name: "Mua bảo hiểm ung thư",
            allowCard: true,
          },
          id: "AJX014TUYI1121",
          amount: 1000000,
          description: "Mua bao hiem ung thu MBAL 615000",
          successMessage:
            "Cám ơn bạn đã mua bảo hiểm. MBAL sẽ liên lạc lại với bạn trong vòng 24h",
        },
      });

      // window["ReactNativeWebView"] &&
      //   window["ReactNativeWebView"].postMessage(params);

      const btnClick = document.getElementById("btn-click");

      btnClick.addEventListener("click", () => {
        console.log("click");
      });

      console.log("End 2");

      function main() {
        console.debug("window.my", window.my);

        if (!window.my) {
          throw new Error(
            "main function has to wait for the Tini app framework ready event"
          );
        }

        my.postMessage('init_done');

        // handle messages from tini app:
        window.addEventListener("message", (e) => {
          alert(JSON.stringify(e.data)); // this will alert "pong" message
        });

      }
      // check if jsapi `my` is available
      // if not, wait until the event `TiniAppJSBridgeReady` is emitted
      try {
        if (window.my) {
          main();
        } else {
          window.addEventListener("TiniAppJSBridgeReady", () => {
            // window.my is available here
            main();
          });
        }
      } catch (e) {
        console.error(e);
        // your code to handle errors goes here
      }
    </script>
  </body>
</html>
